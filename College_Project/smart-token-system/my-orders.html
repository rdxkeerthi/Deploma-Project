<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus-Crave | My Orders</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">
    <style>
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-queue {
            background: #e0e0e0;
            color: #616161;
        }

        .status-cooking {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status-ready {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-completed {
            background: #eeeeee;
            color: #bdbdbd;
            text-decoration: line-through;
        }

        .progress-bar {
            height: 4px;
            background: #eee;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>

<body>
    <script>
        // Auth Guard
        // Auth Guard
        if (localStorage.getItem('nexus_user_token') === null) {
            globalThis.location.href = 'login.html';
        }

        function logout() {
            localStorage.removeItem('nexus_user_token');
            globalThis.location.href = 'login.html';
        }
    </script>
    <div class="container" style="padding-bottom: 80px;">
        <header class="flex justify-between items-center" style="margin-bottom: 1.5rem;">
            <div>
                <h1>My Orders</h1>
                <p style="color: var(--text-secondary);">Track your food in real-time</p>
            </div>
            <button class="btn btn-secondary" style="padding: 0.5rem;" onclick="logout()">Logout</button>
        </header>

        <div id="orders-list">
            <!-- Orders injected here -->
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <span class="nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                    <polyline points="9 22 9 12 15 12 15 22" />
                </svg></span>
            <span>Menu</span>
        </a>
        <a href="my-orders.html" class="nav-item active">
            <span class="nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                    <polyline points="10 9 9 9 8 9" />
                </svg></span>
            <span>Orders</span>
        </a>
    </nav>

    <script type="module">
        import state from './SharedState.js';

        const listContainer = document.getElementById('orders-list');

        function getStatusColor(status) {
            switch (status) {
                case 'In Queue': return 'status-queue';
                case 'Cooking': return 'status-cooking';
                case 'Ready': return 'status-ready';
                case 'Completed': return 'status-completed';
                default: return 'status-queue';
            }
        }

        function getProgress(status) {
            switch (status) {
                case 'In Queue': return '10%';
                case 'Cooking': return '50%';
                case 'Ready': return '100%';
                case 'Completed': return '100%';
                default: return '0%';
            }
        }

        function renderOrders() {
            const orders = state.getOrders();
            listContainer.innerHTML = '';

            if (orders.length === 0) {
                listContainer.innerHTML = `
                    <div style="text-align: center; margin-top: 4rem; color: var(--text-secondary);">
                        <div style="width: 60px; height: 60px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>
                        </div>
                        <p>No orders yet.</p>
                        <a href="index.html" class="btn btn-primary" style="margin-top: 1rem;">Order Now</a>
                    </div>
                `;
                return;
            }

            orders.forEach(order => {
                const date = new Date(order.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const statusClass = getStatusColor(order.status);
                const progress = getProgress(order.status);
                const isReady = order.status === 'Ready';

                const progressStyle = `width: ${progress}; ${isReady ? 'background: var(--success-color);' : ''}`;

                const el = document.createElement('div');
                el.className = 'card animate-pop';
                el.style.marginBottom = '1rem';
                el.innerHTML = `
                    <div class="flex justify-between items-center" style="margin-bottom: 0.5rem;">
                        <span style="font-weight: 700; font-family: monospace; font-size: 1.1rem;">#${order.tokenId}</span>
                        <span class="status-badge ${statusClass}">${order.status}</span>
                    </div>
                    <div class="flex justify-between items-center" style="margin-top: 0.5rem; pt-2; border-top: 1px solid #eee;">
                        <span style="color: var(--text-secondary); font-size: 0.875rem;">
                        ${date} • ${order.items.length} items • ₹${order.total.toFixed(2)}
                        </span>
                    </div>
                    ${order.status === 'Completed' ? '' : `
                        <div class="progress-bar">
                            <div class="progress-fill" style="${progressStyle}"></div>
                        </div>
                    `}
                    ${isReady ? `
                        <div style="margin-top: 1rem; padding: 0.5rem; background: #e8f5e9; border-radius: var(--radius-sm); text-align: center; color: #2e7d32; font-weight: 600;">
                            Ready to Pickup!
                        </div>
                    ` : ''}
                `;
                listContainer.appendChild(el);
            });
        }

        // Init
        renderOrders();

        // Real-time listener
        state.listenForUpdates(() => {
            renderOrders();
        });

    </script>
</body>

</html>